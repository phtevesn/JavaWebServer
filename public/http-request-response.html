<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP Request/Response Anatomy</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #667eea; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        h2 { color: #764ba2; margin-top: 30px; }
        h3 { color: #667eea; margin-top: 20px; }
        .code-block {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            white-space: pre;
        }
        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .note {
            background: #d1ecf1;
            border-left: 4px solid #0c5460;
            padding: 15px;
            margin: 15px 0;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #667eea;
            text-decoration: none;
        }
        .back-link:hover { text-decoration: underline; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #667eea;
            color: white;
        }
        tr:nth-child(even) { background: #f8f9fa; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Home</a>

        <h1>HTTP Request/Response Anatomy</h1>

        <p>Understanding the structure of HTTP messages is fundamental to building a web server. Let's break down exactly what happens when a client talks to a server.</p>

        <h2>HTTP Request Structure</h2>

        <p>Every HTTP request consists of three parts:</p>

        <h3>1. Request Line</h3>
        <p>The first line contains three space-separated components:</p>
        <div class="code-block">GET /echo/1000 HTTP/1.1</div>

        <ul>
            <li><strong>Method:</strong> <code>GET</code> - What action to perform (GET, POST, HEAD, etc.)</li>
            <li><strong>Path:</strong> <code>/echo/1000</code> - The resource being requested</li>
            <li><strong>Version:</strong> <code>HTTP/1.1</code> - The HTTP protocol version</li>
        </ul>

        <h3>2. Headers</h3>
        <p>Key-value pairs providing metadata about the request:</p>
        <div class="code-block">Host: localhost:8080
Connection: keep-alive
User-Agent: Mozilla/5.0
Accept: text/html</div>

        <p>Each header follows the format: <code>Header-Name: value</code></p>

        <h3>3. Body (Optional)</h3>
        <p>For methods like POST, the body contains the data being sent. GET requests typically have no body.</p>

        <h2>Complete HTTP Request Example</h2>
        <div class="code-block">GET /echo/1000 HTTP/1.1
Host: localhost:8080
Connection: keep-alive
User-Agent: ltc/1.0
Accept: */*

</div>
        <p><em>Note: The blank line after headers is required - it signals the end of headers</em></p>

        <h2>HTTP Response Structure</h2>

        <p>Responses mirror requests but start with a status line instead:</p>

        <h3>1. Status Line</h3>
        <div class="code-block">HTTP/1.1 200 OK</div>

        <ul>
            <li><strong>Version:</strong> <code>HTTP/1.1</code></li>
            <li><strong>Status Code:</strong> <code>200</code> - Numeric code indicating result</li>
            <li><strong>Reason Phrase:</strong> <code>OK</code> - Human-readable status</li>
        </ul>

        <h3>2. Response Headers</h3>
        <div class="code-block">Content-Type: text/plain
Content-Length: 1000
X-Payload-Hash: abc123...
Connection: keep-alive</div>

        <h3>3. Response Body</h3>
        <p>The actual content being returned (HTML, JSON, binary data, etc.)</p>

        <h2>Complete HTTP Response Example</h2>
        <div class="code-block">HTTP/1.1 200 OK
Content-Type: text/plain
Content-Length: 1000
X-Payload-Hash: d3b07384d113edec49eaa6238ad5ff00
Connection: keep-alive

0123456789012345678901234567890123456789...</div>

        <h2>Common HTTP Status Codes</h2>

        <table>
            <tr>
                <th>Code</th>
                <th>Meaning</th>
                <th>When Used</th>
            </tr>
            <tr>
                <td><strong>200</strong></td>
                <td>OK</td>
                <td>Request succeeded, returning requested resource</td>
            </tr>
            <tr>
                <td><strong>400</strong></td>
                <td>Bad Request</td>
                <td>Client sent malformed or invalid request</td>
            </tr>
            <tr>
                <td><strong>403</strong></td>
                <td>Forbidden</td>
                <td>Server refuses to fulfill request (e.g., directory traversal)</td>
            </tr>
            <tr>
                <td><strong>404</strong></td>
                <td>Not Found</td>
                <td>Requested resource doesn't exist</td>
            </tr>
            <tr>
                <td><strong>405</strong></td>
                <td>Method Not Allowed</td>
                <td>HTTP method not supported for this resource</td>
            </tr>
            <tr>
                <td><strong>500</strong></td>
                <td>Internal Server Error</td>
                <td>Server encountered an unexpected error</td>
            </tr>
        </table>

        <h2>HTTP/1.1 vs HTTP/1.0</h2>

        <p>The key difference affecting this server:</p>

        <table>
            <tr>
                <th>Feature</th>
                <th>HTTP/1.0</th>
                <th>HTTP/1.1</th>
            </tr>
            <tr>
                <td>Persistent Connections</td>
                <td>No (one request per connection)</td>
                <td>Yes (keep-alive is default)</td>
            </tr>
            <tr>
                <td>Host Header</td>
                <td>Optional</td>
                <td>Required</td>
            </tr>
            <tr>
                <td>Connection Header</td>
                <td>Not used</td>
                <td>Controls connection persistence</td>
            </tr>
        </table>

        <h2>Parsing in Practice</h2>

        <p>In our server, we parse the request like this:</p>

        <div class="code-block">// Read request line
String requestLine = in.readLine();
String[] parts = requestLine.split(" ");
String method = parts[0];    // "GET"
String path = parts[1];      // "/echo/1000"
String version = parts[2];   // "HTTP/1.1"

// Read headers
Map&lt;String, String&gt; headers = new HashMap&lt;&gt;();
String line;
while ((line = in.readLine()) != null && !line.isEmpty()) {
    int colonIndex = line.indexOf(':');
    String headerName = line.substring(0, colonIndex).trim();
    String headerValue = line.substring(colonIndex + 1).trim();
    headers.put(headerName.toLowerCase(), headerValue);
}</div>

        <div class="note">
            <strong>üí° Key Insight:</strong> The blank line between headers and body is crucial. When <code>in.readLine()</code> returns an empty string, you know the headers are done. This is how HTTP delimits sections without needing a length prefix for headers.
        </div>

        <h2>CRLF Line Endings</h2>

        <p>HTTP requires <span class="highlight">CRLF</span> (<code>\r\n</code>) line endings, not just LF (<code>\n</code>):</p>

        <div class="code-block">// Correct HTTP response line
writer.print("HTTP/1.1 200 OK\r\n");

// Not just \n!
writer.print("HTTP/1.1 200 OK\n");  // ‚ùå Not HTTP-compliant</div>

        <p>Java's <code>BufferedReader.readLine()</code> handles both CRLF and LF when reading, but when <strong>writing</strong> responses, you must use <code>\r\n</code>.</p>

        <h2>Try It Yourself</h2>

        <p>Use these curl commands to see raw HTTP requests/responses:</p>

        <div class="code-block"># View full HTTP exchange (verbose mode)
curl -v http://localhost:8080/echo/100

# See just the response headers
curl -I http://localhost:8080/echo/100

# Send a custom header
curl -H "Connection: close" http://localhost:8080/echo/100</div>

        <div class="note">
            <strong>üìö Further Reading:</strong>
            <ul style="margin: 10px 0 0 20px;">
                <li><a href="http-headers.html">HTTP Headers Reference</a> - Deep dive into important headers</li>
                <li><a href="parsing-requests.html">Parsing HTTP Requests</a> - Implementation details</li>
                <li><a href="testing-curl.html">Testing with curl</a> - More curl examples</li>
            </ul>
        </div>

        <p style="margin-top: 40px;"><a href="index.html" class="back-link">‚Üê Back to Home</a></p>
    </div>
</body>
</html>
